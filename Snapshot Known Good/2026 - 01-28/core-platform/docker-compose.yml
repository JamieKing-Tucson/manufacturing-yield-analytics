networks:
  itar-core: {}

volumes:
  rp1-data:
  rp2-data:
  rp3-data:
  minio-data:

services:
  redpanda-1:
    image: redpandadata/redpanda:v23.3.17
    container_name: redpanda-1
    restart: unless-stopped
    command:
      - redpanda
      - start
      - --smp
      - "2"
      - --memory
      - "2G"
      - --reserve-memory
      - "0M"
      - --overprovisioned
      - --node-id
      - "1"
      - --check=false
      - --kafka-addr
      - PLAINTEXT://0.0.0.0:9092,OUTSIDE://0.0.0.0:19092
      - --advertise-kafka-addr
      - PLAINTEXT://redpanda-1:9092,OUTSIDE://localhost:19092
      - --rpc-addr
      - 0.0.0.0:33145
      - --advertise-rpc-addr
      - redpanda-1:33145
    ports:
      - "19092:19092"
      - "9644:9644"
    volumes:
      - rp1-data:/var/lib/redpanda/data
    networks: [itar-core]

  redpanda-2:
    image: redpandadata/redpanda:v23.3.17
    container_name: redpanda-2
    restart: unless-stopped
    command:
      - redpanda
      - start
      - --smp
      - "2"
      - --memory
      - "2G"
      - --reserve-memory
      - "0M"
      - --overprovisioned
      - --node-id
      - "2"
      - --check=false
      - --kafka-addr
      - PLAINTEXT://0.0.0.0:9092
      - --advertise-kafka-addr
      - PLAINTEXT://redpanda-2:9092
      - --rpc-addr
      - 0.0.0.0:33145
      - --advertise-rpc-addr
      - redpanda-2:33145
      - --seeds
      - redpanda-1:33145
    volumes:
      - rp2-data:/var/lib/redpanda/data
    depends_on: [redpanda-1]
    networks: [itar-core]

  redpanda-3:
    image: redpandadata/redpanda:v23.3.17
    container_name: redpanda-3
    restart: unless-stopped
    command:
      - redpanda
      - start
      - --smp
      - "2"
      - --memory
      - "2G"
      - --reserve-memory
      - "0M"
      - --overprovisioned
      - --node-id
      - "3"
      - --check=false
      - --kafka-addr
      - PLAINTEXT://0.0.0.0:9092
      - --advertise-kafka-addr
      - PLAINTEXT://redpanda-3:9092
      - --rpc-addr
      - 0.0.0.0:33145
      - --advertise-rpc-addr
      - redpanda-3:33145
      - --seeds
      - redpanda-1:33145
    volumes:
      - rp3-data:/var/lib/redpanda/data
    depends_on: [redpanda-1]
    networks: [itar-core]

  schema-registry:
    image: confluentinc/cp-schema-registry:7.6.0
    container_name: schema-registry
    restart: unless-stopped
    depends_on: [redpanda-1]
    environment:
      SCHEMA_REGISTRY_HOST_NAME: schema-registry
      SCHEMA_REGISTRY_LISTENERS: http://0.0.0.0:8081
      SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS: PLAINTEXT://redpanda-1:9092
    ports:
      - "8081:8081"
    networks: [itar-core]

  console:
    image: redpandadata/console:v2.4.5
    container_name: rp-console
    restart: unless-stopped
    depends_on:
    - redpanda-1
    - schema-registry
    volumes:
    - ./core-platform/console-config.yaml:/etc/console.yaml:ro
    entrypoint: /app/console
    command: "--config.filepath=/etc/console.yaml"  
    ports:
      - "8080:8080"
    networks: [itar-core]

  node-exporter:
    image: prom/node-exporter:v1.8.2
    container_name: node-exporter
    restart: unless-stopped
    command:
      - --path.procfs=/host/proc
      - --path.sysfs=/host/sys
      - --path.rootfs=/rootfs
      - --collector.filesystem.mount-points-exclude=^/(proc|sys|dev|etc|host|rootfs/var/lib/docker/.+)($|/)
    volumes:
      - /proc:/host/proc:ro
      - /sys:/host/sys:ro
      - /:/rootfs:ro
    ports:
      - "9100:9100"
    networks: [itar-core]

  minio:
    image: minio/minio:RELEASE.2024-01-16T16-07-38Z
    container_name: minio
    restart: unless-stopped
    command: server /data --console-address ":9001"
    environment:
      MINIO_ROOT_USER: ${MINIO_ROOT_USER}
      MINIO_ROOT_PASSWORD: ${MINIO_ROOT_PASSWORD}
    volumes:
      - minio-data:/data
    ports:
      - "9000:9000"
      - "9001:9001"
    networks: [itar-core]
